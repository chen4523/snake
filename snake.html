<!DOCTYPE html>
<html>
<head>
  <title>貪吃蛇</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #ffdab9;
      transition: background 2s;
    }
    body.dark-mode {
      background: #2B2B2B;
      color: #fff;
    }
    canvas {
      border: 1px solid #000;
      transition: border-color 2s;
    }
    canvas.dark-mode {
      border-color: #fff;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }
    button {
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.5s, color 0.5s;
    }
    .active {
      background: #000;
      color: #fff;
    }
    #instructions {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="400"></canvas>
  <div id="controls">
    <button id="pauseBtn" class="light-mode">暫停</button>
    <button id="darkModeBtn" class="light-mode">深色模式</button>
  </div>
  <div id="instructions" class="light-mode">
    <p>space：暫停</p>
    <p>shift：衝刺</p>
    <p>ctrl：深色模式/淺色模式</p>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const context = canvas.getContext('2d');
    const grid = 16;
    let snake = [{x: 160, y: 160}, {x: 144, y: 160}, {x: 128, y: 160}];
    let direction = 'right';
    let food = generateFood();
    let speed = 200;
    let isSprinting = false;
    let sprintTime = 0;
    let isPaused = false;
    let isDarkMode = false;

    function generateFood() {
      let newFood;
      while (true) {
        newFood = {
          x: Math.floor(Math.random() * canvas.width / grid) * grid,
          y: Math.floor(Math.random() * canvas.height / grid) * grid
        };
        if (!snake.some(segment => segment.x === newFood.x && segment.y === newFood.y)) {
          return newFood;
        }
      }
    }

    function resetGame() {
      snake = [{x: 160, y: 160}, {x: 144, y: 160}, {x: 128, y: 160}];
      direction = 'right';
      food = generateFood();
      speed = 200;
      isSprinting = false;
      sprintTime = 0;
      isPaused = false;
      clearInterval(gameLoop);
      gameLoop = setInterval(loop, speed);
      document.getElementById('pauseBtn').classList.remove('active');
    }

    function loop() {
      if (isPaused) return;

      if (direction === 'right') {
        snake.unshift({x: (snake[0].x + grid) % canvas.width, y: snake[0].y});
      }
      if (direction === 'left') {
        snake.unshift({x: (snake[0].x - grid + canvas.width) % canvas.width, y: snake[0].y});
      }
      if (direction === 'down') {
        snake.unshift({x: snake[0].x, y: (snake[0].y + grid) % canvas.height});
      }
      if (direction === 'up') {
        snake.unshift({x: snake[0].x, y: (snake[0].y - grid + canvas.height) % canvas.height});
      }

      if (snake[0].x === food.x && snake[0].y === food.y) {
        food = generateFood();
      } else {
        snake.pop();
      }

      context.clearRect(0, 0, canvas.width, canvas.height);
      snake.forEach((segment, index) => {
        const greenToYellow = Math.floor((index / (5 + snake.length)) * 255);
        context.fillStyle = isDarkMode
          ? `rgb(${0 + greenToYellow}, ${255 - greenToYellow}, 255)`
          : `rgb(${0 + greenToYellow}, 255, 0)`; // 反轉顏色
        context.fillRect(segment.x, segment.y, grid, grid);
      });
      context.fillStyle = isDarkMode ? '#ff6666' : '#ff6666';
      context.fillRect(food.x, food.y, grid, grid);

      for (let i = 4; i < snake.length; i++) {
        if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
          resetGame();
        }
      }
    }

    let gameLoop = setInterval(loop, speed);

    document.addEventListener('keydown', function(e) {
      if (e.key === ' ') {
        isPaused = !isPaused;
        document.getElementById('pauseBtn').classList.toggle('active');
      }
      if (e.key === 'Control') {
        toggleDarkMode();
      }
      if (e.key === 'Shift') {
        isSprinting = true;
        clearInterval(gameLoop);
        gameLoop = setInterval(loop, 50);
      }
      if (isPaused) return;
      if (e.key === 'w' && direction !== 'down') {
        direction = 'up';
      } else if (e.key === 's' && direction !== 'up') {
        direction = 'down';
      } else if (e.key === 'a' && direction !== 'right') {
        direction = 'left';
      } else if (e.key === 'd' && direction !== 'left') {
        direction = 'right';
      }
    });

    document.addEventListener('keyup', function(e) {
      if (e.key === 'Shift') {
        isSprinting = false;
        clearInterval(gameLoop);
        gameLoop = setInterval(loop, speed);
      }
    });

    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });

    document.getElementById('pauseBtn').addEventListener('click', function() {
      isPaused = !isPaused;
      this.classList.toggle('active');
    });

    document.getElementById('darkModeBtn').addEventListener('click', toggleDarkMode);

    function toggleDarkMode() {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode');
      canvas.classList.toggle('dark-mode');
      document.getElementById('darkModeBtn').classList.toggle('dark-mode');
      document.getElementById('pauseBtn').classList.toggle('dark-mode');
      document.getElementById('darkModeBtn').textContent = isDarkMode ? '淺色模式' : '深色模式';
    }
  </script>
</body>
</html>
